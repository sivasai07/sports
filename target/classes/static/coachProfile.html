<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Shared Color Scheme */
        :root {
            --primary-color: #0077be; /* Blue */
            --secondary-color: #00a86b; /* Green */
            --text-light: #f4f4f4;
            --background-dark: #121212;
            --gradient-primary: linear-gradient(135deg, #0077be 0%, #00a86b 100%);
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: rgb(16,16,18);
            background: linear-gradient(108deg, rgba(16,16,18,1) 0%, rgba(1,28,55,1) 100%);
            color: var(--text-light);
            line-height: 1.6;
            overflow-x: hidden;
            font-size: 16px;
        }

        /* Navigation Bar */
        nav {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        nav .logo {
            color: #fff;
            font-size: 1.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        nav .nav-links {
            list-style-type: none;
            padding: 0;
            margin: 0;
            display: flex;
        }

        nav .nav-links li {
            margin: 0 15px;
        }

        nav .nav-links a {
            text-decoration: none;
            color: #fff;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        nav .nav-links a:hover {
            color: var(--primary-color);
        }

        /* Profile Container */
        .container {
          background: rgba(0, 0, 0, 0.85);
    background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png'); /* Subtle patterned texture */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
            width: 1000px;
            margin-top: 80px;
            color: #fff;
        }

        /* Profile Section */
        .profile-section {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }

        .profile-section img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
        }

        .profile-section .ms-4 {
            margin-left: 20px;
        }

        .profile-section h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .profile-section p {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .profile-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 16px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }

        .profile-button:hover {
            background-color: var(--secondary-color);
        }

        /* Edit Form Section (Smaller) */
        .edit-section {
            margin-top: 20px;
            display: none;
            max-width: 600px; /* Set a maximum width for the form */
            margin: 0 auto; /* Center the form */
            padding: 20px;
            background: linear-gradient(108deg, rgba(16,16,18,1) 0%, rgba(1,28,55,1) 100%); /* Semi-transparent black */
    backdrop-filter: blur(10px); /* Blurs the area behind the edit section */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }

        .edit-section h4 {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            color: #333;
        }

        .form-label {
            font-weight: bold;
            color: #fff;
            display: block;
            margin-bottom: 5px;
        }

        /* Button styling for Save Changes */
        .btn-primary-custom {
            padding: 12px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .btn-primary-custom:hover {
            background: var(--secondary-color);
        }

        /* Cancel button */
        .btn-cancel {
            padding: 12px 30px;
            background: #d9534f;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 15px;
            transition: background-color 0.3s ease;
        }

        .btn-cancel:hover {
            background: #c9302c;
        }

        /* Ensure the page scrolls smoothly */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>

<!-- Navigation Bar -->
<nav>
    <a href="#" class="logo">Coach Portal</a>
    <ul class="nav-links">
        <li><a href="coachdashboard.html">Dashboard</a></li>
        <li><a href="coachProfile.html">Profile</a></li>
        <li><a href="coachevents.html">Events</a></li>
        <li><a href="coachteams.html">Teams</a></li>
        <li><a href="coachperformance.html">Performance</a></li>
        <li><a href="coachmyteam.html">My Team</a></li>
        <li><a href="coachnotifications.html">Notifications</a></li>
        <li><a href="index.html" onclick="logout()">Logout</a></li>
    </ul>
</nav>

<!-- Profile Container -->
<div class="container">
    <!-- Header -->
    <h1>Coach Profile</h1>
    <hr>

    <!-- Profile Section -->
    <div class="profile-section" id="profile-section">
        <img id="profile-pic" src="https://via.placeholder.com/150" alt="Coach Picture">
        <div class="ms-4">
            <h3 id="profile-name">Loading...</h3>
            <p><strong>Experience:</strong> <span id="experience">Loading...</span></p>
            <p><strong>Specialty:</strong> <span id="specialty">Loading...</span></p>
            <p><strong>Teams Managed:</strong> <span id="teams-managed">Loading...</span></p>
            <p><strong>Contact:</strong> <span id="contact">Loading...</span></p>
            <button class="profile-button" onclick="toggleEditSection()">Edit Profile</button>
        </div>
    </div>

    <!-- Edit Form Section -->
    <div class="edit-section" id="edit-section">
        <h4>Edit Profile</h4>
        <form id="edit-form">
            <label for="edit-name" class="form-label">Name</label>
            <input type="text" id="edit-name" class="form-input" placeholder="Enter your name">

            <label for="edit-experience" class="form-label">Experience</label>
            <input type="number" id="edit-experience" class="form-input" placeholder="Years of experience">

            <label for="edit-specialty" class="form-label">Specialty</label>
            <input type="text" id="edit-specialty" class="form-input" placeholder="Specialty (e.g. Sprints, Endurance)">

            <label for="edit-teams-managed" class="form-label">Teams Managed</label>
            <input type="number" id="edit-teams-managed" class="form-input" placeholder="Number of teams managed">

            <label for="edit-contact" class="form-label">Contact</label>
            <input type="email" id="edit-contact" class="form-input" placeholder="Contact Email">

            <div class="d-flex justify-content-center mt-3">
                <button type="button" class="btn-primary-custom" onclick="saveProfile()">Save Changes</button>
                <button type="button" class="btn-cancel" onclick="cancelEdit()">Cancel</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', initializePage);

function initializePage() {
    const userId = getUserIdFromLocalStorage();
    if (userId) {
        displayUserProfile(userId);
    } else {
        console.error('User ID not found in localStorage');
    }
}

// Fetch user ID from localStorage
function getUserIdFromLocalStorage() {
    return localStorage.getItem('id');
}

// Simulate fetching and displaying the user profile (mock data for now, replace with actual API call)
function displayUserProfile(userId) {
    fetch(`/api/coaches/${userId}`)
        .then(response => {
            if (!response.ok) throw new Error('Failed to fetch user profile');
            return response.json();
        })
        .then(data => {
            updateProfileUI(data);  // Display the fetched user data
        })
        .catch(error => console.error('Error:', error));
}

// Update profile UI with fetched data
function updateProfileUI(data) {
    document.getElementById('profile-name').textContent = `${data.firstName} ${data.lastName}`;
    document.getElementById('experience').textContent = `${data.experience || 0} Years`;
    document.getElementById('specialty').textContent = data.category || 'N/A';
    document.getElementById('teams-managed').textContent = data.teamsManaged || '0';
    document.getElementById('contact').textContent = data.email || 'N/A';
    document.getElementById('profile-pic').src = data.photoUrl || 'https://via.placeholder.com/150';

    // Prepopulate the edit form with current profile data
    document.getElementById('edit-name').value = `${data.firstName} ${data.lastName}`;
    document.getElementById('edit-experience').value = data.experience || 0;
    document.getElementById('edit-specialty').value = data.category || '';
    document.getElementById('edit-teams-managed').value = data.teamsManaged || 0;
    document.getElementById('edit-contact').value = data.email || '';
}

// Toggle between profile and edit sections
function toggleEditSection() {
    const editSection = document.getElementById('edit-section');
    const profileSection = document.getElementById('profile-section');

    const isEditVisible = editSection.style.display === 'block';
    editSection.style.display = isEditVisible ? 'none' : 'block';
    profileSection.style.display = isEditVisible ? 'block' : 'none';
}

// Gather data from the edit form and update the profile
function saveProfile() {
    const updatedProfile = gatherUpdatedProfileData();
    const userId = getUserIdFromLocalStorage();

    // Update coach details using the API
    updateProfileData(userId, updatedProfile);
}

// Gather updated profile data from form inputs
function gatherUpdatedProfileData() {
    const fullName = document.getElementById('edit-name').value.split(' ');
    return {
        firstName: fullName[0],
        lastName: fullName[1] || '',
        experience: parseInt(document.getElementById('edit-experience').value) || 0,
        category: document.getElementById('edit-specialty').value,
        teamsManaged: parseInt(document.getElementById('edit-teams-managed').value) || 0,
        email: document.getElementById('edit-contact').value,
    };
}

// Update profile on the server
function updateProfileData(id, updatedProfile) {
    fetch(`/api/coaches/update/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(updatedProfile),
    })
        .then(response => {
            if (!response.ok) throw new Error('Failed to update profile');
            return response.json();
        })
        .then(data => {
            alert('Profile updated successfully!');
            // After saving, refetch and update the UI with the latest data
            fetchProfileData(id);
            toggleEditSection();  // Hide edit section after saving
        })
        .catch(error => console.error('Error:', error));
}

// Fetch updated profile data after saving and update the UI
function fetchProfileData(id) {
    fetch(`/api/coaches/${id}`)
        .then(response => {
            if (!response.ok) throw new Error('Failed to fetch updated profile');
            return response.json();
        })
        .then(data => {
            updateProfileUI(data);  // Update the profile UI with the new data
        })
        .catch(error => console.error('Error:', error));
}

// Cancel edit and hide the edit form
function cancelEdit() {
    toggleEditSection();  // Just close the edit form without saving changes
}

</script>

</body>
</html>
